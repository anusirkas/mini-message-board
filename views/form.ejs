<!DOCTYPE html>
<html>
<head>
  <title><%= title %></title>
  <link rel="stylesheet" href="/styles.css">

  <!-- Put the dark class as soon as localStorage says to -->  
  <script>
    (() => {
      if (localStorage.getItem("theme") === "dark") {
        document.documentElement.classList.add("dark");
      }
    })();
  </script>
</head>

<body>
  <!-- Night/Day toggle -->
  <button id="mode-toggle" class="mode-toggle">🌙</button>

  <div class="new-message-container">
    <form method="POST" action="/new" class="new-message-form">
      <div class="form-group">
        <input type="text" id="user" name="user" placeholder="Your name" required>
      </div>

      <div class="form-group message-input">
        <textarea id="text" name="text" rows="4" placeholder="Type your message..." required></textarea>
        <button type="button" id="emoji-btn" class="emoji-btn">😊</button>
        <div id="emoji-picker" class="emoji-picker hidden"></div>
      </div>

      <div class="form-actions">
        <button type="submit" class="send-btn">Send</button>
      </div>
    </form>

    <p class="back-link"><a href="/">← Back to board</a></p>
  </div>

  <!-- common toggle logic -->
  <script src="/theme.js"></script>

  <!-- Emoji picker -->
  <script>
    const emojiBtn = document.getElementById("emoji-btn");
    const emojiPicker = document.getElementById("emoji-picker");
    const textarea = document.getElementById("text");
    const emojis = ["😀","😁","😂","🤣","😎","😍","😢","😡","👍","👎","🙏","🎉","🔥","❤️","⭐","🌍","🍕","🍔","🍺","☕"];

    emojiBtn.addEventListener("click", () => {
      emojiPicker.classList.toggle("hidden");
      if (!emojiPicker.hasChildNodes()) {
        emojis.forEach(e => {
          const span = document.createElement("span");
          span.textContent = e;
          span.classList.add("emoji");
          span.onclick = () => { textarea.value += e; };
          emojiPicker.appendChild(span);
        });
      }
    });
  </script>
</body>
</html>
