<!DOCTYPE html>
<html>
<head>
  <title><%= title %></title>
  <link rel="stylesheet" href="/styles.css">

  <!-- Theme restore kohe, enne renderdamist -->
  <script>
    (() => {
      const saved = localStorage.getItem("theme");
      if (saved === "dark") {
        document.documentElement.classList.add("dark");
      }
    })();
  </script>
</head>

<body>
  <div class="board-container">
    <button id="mode-toggle" class="mode-toggle">🌙</button>

    <ul class="messages">
      <% messages.slice().reverse().forEach((msg, i) => { %>
        <li class="message-item">
          <div
            class="avatar"
            style="background-color: <%= avatarColors[Math.abs(msg.user.charCodeAt(0)) % avatarColors.length] %>;">
            <%= msg.user.charAt(0).toUpperCase() %>
          </div>

          <div class="message-content">
            <p class="user"><%= msg.user %></p>
            <p class="text"><%= msg.text %></p>
            <p class="timestamp">
              <%= msg.added.toLocaleString("en-US", {
                  month: "short", day: "numeric", year: "numeric",
                  hour: "2-digit", minute: "2-digit"
              }) %>
            </p>
          </div>
        </li>
      <% }) %>
    </ul>
  </div>

  <a href="/new" class="floating-button">Send message</a>

    <script>
        const toggle = document.getElementById("mode-toggle");
        toggle.addEventListener("click", () => {
            document.body.classList.toggle("dark");
            toggle.textContent = document.body.classList.contains("dark") ? "☀️" : "🌙";
            localStorage.setItem("theme", document.body.classList.contains("dark") ? "dark" : "light");
        });

        // Kui tuli dark localStoragest, uuenda ka nupp
        if (localStorage.getItem("theme") === "dark") {
            toggle.textContent = "☀️";
        }
    </script>

</body>
</html>
